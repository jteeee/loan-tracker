<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sarah & Deklin Loan Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #5b21b6;
            --primary-light: #7c3aed;
            --primary-dark: #4c1d95;
            --success: #10b981;
            --danger: #ef4444;
            --info: #3b82f6;
            --warning: #f59e0b;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--gray-800);
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .content {
            padding: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            border: 1px solid var(--gray-200);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
        }
        
        .stat-card.danger::before {
            background: linear-gradient(90deg, var(--danger) 0%, #f87171 100%);
        }
        
        .stat-card.success::before {
            background: linear-gradient(90deg, var(--success) 0%, #34d399 100%);
        }
        
        .stat-card.info::before {
            background: linear-gradient(90deg, var(--info) 0%, #60a5fa 100%);
        }
        
        .stat-card.warning::before {
            background: linear-gradient(90deg, var(--warning) 0%, #fbbf24 100%);
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-900);
        }
        
        .stat-subtext {
            font-size: 0.875rem;
            color: var(--gray-500);
            margin-top: 5px;
        }
        
        .input-section {
            background: var(--gray-50);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 40px;
            border: 1px solid var(--gray-200);
        }
        
        .input-section h2 {
            color: var(--gray-800);
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 2fr auto;
            gap: 15px;
            align-items: end;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 8px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px 14px;
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(91, 33, 182, 0.1);
        }
        
        .btn {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(91, 33, 182, 0.3);
        }
        
        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }
        
        .btn-secondary:hover {
            background: var(--gray-300);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            border: 1px solid var(--gray-200);
        }
        
        .table-header {
            background: var(--gray-50);
            padding: 20px 25px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-header h2 {
            font-size: 1.5rem;
            color: var(--gray-800);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: var(--gray-50);
        }
        
        th {
            padding: 14px 20px;
            text-align: left;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--gray-200);
        }
        
        td {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-100);
        }
        
        tbody tr {
            transition: background-color 0.2s;
        }
        
        tbody tr:hover {
            background: var(--gray-50);
        }
        
        .type-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .type-badge.loan {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .type-badge.payment {
            background: #d1fae5;
            color: #065f46;
        }
        
        .amount-cell {
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }
        
        .loan-amount {
            color: var(--danger);
        }
        
        .payment-amount {
            color: var(--success);
        }
        
        .interest-amount {
            color: var(--warning);
        }
        
        .balance-amount {
            color: var(--primary);
            font-weight: 700;
        }
        
        .notes-cell {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.875rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-500);
        }
        
        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .controls-section {
            margin-top: 40px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            margin-bottom: 20px;
        }
        
        .modal-header h3 {
            font-size: 1.5rem;
            color: var(--gray-800);
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 640px) {
            .header h1 {
                font-size: 1.75rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .table-container {
                overflow-x: auto;
            }
            
            table {
                min-width: 800px;
            }
        }
        
        .interest-info {
            background: #fef3c7;
            color: #92400e;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.875rem;
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .new-row {
            animation: slideIn 0.3s ease-out;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
                Sarah & Deklin Loan Tracker
            </h1>
            <p>Track loans and repayments with automatic interest calculation at 8.25% APR</p>
        </div>
        
        <div class="content">
            <!-- Summary Statistics -->
            <div class="stats-grid">
                <div class="stat-card danger">
                    <div class="stat-label">Current Balance</div>
                    <div class="stat-value" id="currentBalance">$0.00</div>
                    <div class="stat-subtext" id="balanceChange">No transactions yet</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Total Loaned Out</div>
                    <div class="stat-value" id="totalLoaned">$0.00</div>
                    <div class="stat-subtext" id="loanCount">0 loans</div>
                </div>
                
                <div class="stat-card success">
                    <div class="stat-label">Total Payments</div>
                    <div class="stat-value" id="totalPayments">$0.00</div>
                    <div class="stat-subtext" id="paymentCount">0 payments</div>
                </div>
                
                <div class="stat-card warning">
                    <div class="stat-label">Total Interest</div>
                    <div class="stat-value" id="totalInterest">$0.00</div>
                    <div class="stat-subtext" id="effectiveRate">0.00% of principal</div>
                </div>
                
                <div class="stat-card info">
                    <div class="stat-label">Days Active</div>
                    <div class="stat-value" id="daysActive">0</div>
                    <div class="stat-subtext" id="dateRange">No activity</div>
                </div>
            </div>
            
            <!-- Add Transaction Form -->
            <div class="input-section">
                <h2>Add New Transaction</h2>
                <div class="input-grid">
                    <div class="form-group">
                        <label for="transactionDate">Date</label>
                        <input type="date" id="transactionDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="transactionType">Type</label>
                        <select id="transactionType" required>
                            <option value="Loan Out">Loan Out</option>
                            <option value="Payment">Payment</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="transactionAmount">Amount ($)</label>
                        <input type="number" id="transactionAmount" step="0.01" min="0.01" placeholder="0.00" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="transactionNotes">Notes (Optional)</label>
                        <input type="text" id="transactionNotes" placeholder="Add any notes here...">
                    </div>
                    
                    <button class="btn btn-primary" onclick="addTransaction()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14m-7-7h14"/>
                        </svg>
                        Add
                    </button>
                </div>
                
                <div class="interest-info">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/><path d="M12 16v-4m0-4h.01"/>
                    </svg>
                    Interest is calculated daily at 8.25% annual rate on the outstanding balance
                </div>
            </div>
            
            <!-- Transaction History -->
            <div class="table-container">
                <div class="table-header">
                    <h2>Transaction History</h2>
                    <div id="entryCount" style="color: var(--gray-600); font-size: 0.875rem;"></div>
                </div>
                
                <div id="tableContent">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Days</th>
                                <th>Interest</th>
                                <th>Balance</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="transactionTableBody">
                        </tbody>
                    </table>
                    
                    <div class="empty-state" id="emptyState">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                        <h3>No transactions yet</h3>
                        <p>Add your first transaction to get started</p>
                    </div>
                </div>
            </div>
            
            <!-- Control Buttons -->
            <div class="controls-section">
                <button class="btn btn-secondary" onclick="exportToExcel()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4m4-5l5 5 5-5m-5 5V3"/>
                    </svg>
                    Export to Excel
                </button>
                
                <button class="btn btn-secondary" onclick="printReport()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                        <rect x="6" y="14" width="12" height="8"/>
                    </svg>
                    Print Report
                </button>
                
                <button class="btn btn-secondary" onclick="saveData()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Save Data
                </button>
                
                <button class="btn btn-secondary" onclick="loadData()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 13V7a2 2 0 00-2-2H4a2 2 0 00-2 2v10c0 1.1.9 2 2 2h8"/>
                        <path d="m4 8 10 6 10-6"/><path d="m16 22 5-5m0 0-5-5m5 5H10"/>
                    </svg>
                    Load Data
                </button>
                
                <button class="btn btn-danger" onclick="clearAllData()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                    Clear All
                </button>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Settings</h3>
            </div>
            <div class="alert alert-info">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/><path d="M12 16v-4m0-4h.01"/>
                </svg>
                Interest rate is fixed at 8.25% annual rate as per loan agreement
            </div>
        </div>
    </div>
    
    <script>
        // Constants
        const INTEREST_RATE = 0.0825; // 8.25% annual rate
        
        // State
        let transactions = [];
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default
            document.getElementById('transactionDate').valueAsDate = new Date();
            
            // Load any saved data
            loadFromLocalStorage();
            
            // Initial update
            updateDisplay();
        });
        
        // Calculate interest
        function calculateInterest(principal, startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const days = Math.max(0, (end - start) / (1000 * 60 * 60 * 24));
            const dailyRate = INTEREST_RATE / 365;
            return principal * dailyRate * days;
        }
        
        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }
        
        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        // Add transaction
        function addTransaction() {
            const date = document.getElementById('transactionDate').value;
            const type = document.getElementById('transactionType').value;
            const amount = parseFloat(document.getElementById('transactionAmount').value);
            const notes = document.getElementById('transactionNotes').value;
            
            // Validation
            if (!date || !amount || amount <= 0) {
                alert('Please enter a valid date and amount');
                return;
            }
            
            // Add transaction
            transactions.push({
                id: Date.now(),
                date: date,
                type: type,
                amount: amount,
                notes: notes
            });
            
            // Sort by date
            transactions.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Clear form
            document.getElementById('transactionAmount').value = '';
            document.getElementById('transactionNotes').value = '';
            
            // Update display
            updateDisplay();
            
            // Save to localStorage
            saveToLocalStorage();
        }
        
        // Delete transaction
        function deleteTransaction(id) {
            if (confirm('Are you sure you want to delete this transaction?')) {
                transactions = transactions.filter(t => t.id !== id);
                updateDisplay();
                saveToLocalStorage();
            }
        }
        
        // Update display
        function updateDisplay() {
            // Initialize variables
            let balance = 0;
            let totalLoaned = 0;
            let totalPayments = 0;
            let totalInterest = 0;
            let loanCount = 0;
            let paymentCount = 0;
            
            // Clear table
            const tbody = document.getElementById('transactionTableBody');
            tbody.innerHTML = '';
            
            // Show/hide empty state
            document.getElementById('emptyState').style.display = transactions.length === 0 ? 'block' : 'none';
            document.getElementById('tableContent').querySelector('table').style.display = transactions.length === 0 ? 'none' : 'table';
            
            // Process transactions
            let previousDate = null;
            
            transactions.forEach((transaction, index) => {
                // Calculate days since last entry
                let daysSinceLastEntry = 0;
                if (previousDate) {
                    daysSinceLastEntry = Math.max(0, (new Date(transaction.date) - new Date(previousDate)) / (1000 * 60 * 60 * 24));
                }
                
                // Calculate interest
                let interestAccrued = 0;
                if (previousDate && balance > 0) {
                    interestAccrued = calculateInterest(balance, previousDate, transaction.date);
                    totalInterest += interestAccrued;
                }
                
                // Update balance with interest
                balance += interestAccrued;
                
                // Apply transaction
                if (transaction.type === 'Loan Out') {
                    balance += transaction.amount;
                    totalLoaned += transaction.amount;
                    loanCount++;
                } else {
                    balance -= transaction.amount;
                    totalPayments += transaction.amount;
                    paymentCount++;
                }
                
                // Create table row
                const row = document.createElement('tr');
                if (index === transactions.length - 1) {
                    row.classList.add('new-row');
                }
                
                row.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td>
                        <span class="type-badge ${transaction.type === 'Loan Out' ? 'loan' : 'payment'}">
                            ${transaction.type === 'Loan Out' ? 
                                '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14m-7-7h14"/></svg>' : 
                                '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/></svg>'}
                            ${transaction.type}
                        </span>
                    </td>
                    <td class="amount-cell ${transaction.type === 'Loan Out' ? 'loan-amount' : 'payment-amount'}">
                        ${formatCurrency(transaction.amount)}
                    </td>
                    <td>${daysSinceLastEntry > 0 ? Math.round(daysSinceLastEntry) : '-'}</td>
                    <td class="amount-cell interest-amount">
                        ${interestAccrued > 0 ? formatCurrency(interestAccrued) : '-'}
                    </td>
                    <td class="amount-cell balance-amount">
                        ${formatCurrency(balance)}
                    </td>
                    <td class="notes-cell" title="${transaction.notes || ''}">${transaction.notes || '-'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-danger" onclick="deleteTransaction(${transaction.id})">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
                previousDate = transaction.date;
            });
            
            // Calculate interest to today if there's a balance
            let interestToToday = 0;
            if (balance > 0 && previousDate) {
                const today = new Date().toISOString().split('T')[0];
                interestToToday = calculateInterest(balance, previousDate, today);
                totalInterest += interestToToday;
            }
            
            // Update summary statistics
            document.getElementById('currentBalance').textContent = formatCurrency(balance + interestToToday);
            document.getElementById('totalLoaned').textContent = formatCurrency(totalLoaned);
            document.getElementById('totalPayments').textContent = formatCurrency(totalPayments);
            document.getElementById('totalInterest').textContent = formatCurrency(totalInterest);
            
            document.getElementById('loanCount').textContent = `${loanCount} loan${loanCount !== 1 ? 's' : ''}`;
            document.getElementById('paymentCount').textContent = `${paymentCount} payment${paymentCount !== 1 ? 's' : ''}`;
            
            // Calculate effective rate
            const effectiveRate = totalLoaned > 0 ? (totalInterest / totalLoaned * 100) : 0;
            document.getElementById('effectiveRate').textContent = `${effectiveRate.toFixed(2)}% of principal`;
            
            // Update balance change text
            if (transactions.length > 0) {
                const lastTransaction = transactions[transactions.length - 1];
                const changeText = lastTransaction.type === 'Loan Out' ? 
                    `Last loan: ${formatCurrency(lastTransaction.amount)}` : 
                    `Last payment: ${formatCurrency(lastTransaction.amount)}`;
                document.getElementById('balanceChange').textContent = changeText;
            }
            
            // Update days active
            if (transactions.length > 0) {
                const firstDate = new Date(transactions[0].date);
                const lastDate = new Date(transactions[transactions.length - 1].date);
                const daysActive = Math.max(1, Math.round((lastDate - firstDate) / (1000 * 60 * 60 * 24)));
                document.getElementById('daysActive').textContent = daysActive;
                document.getElementById('dateRange').textContent = `${formatDate(transactions[0].date)} - ${formatDate(transactions[transactions.length - 1].date)}`;
            } else {
                document.getElementById('daysActive').textContent = '0';
                document.getElementById('dateRange').textContent = 'No activity';
            }
            
            // Update entry count
            document.getElementById('entryCount').textContent = `${transactions.length} entries`;
            
            // Add row for current interest if applicable
            if (interestToToday > 0 && transactions.length > 0) {
                const row = document.createElement('tr');
                row.style.backgroundColor = 'var(--gray-50)';
                row.innerHTML = `
                    <td>${formatDate(new Date())}</td>
                    <td><span class="type-badge" style="background: #fef3c7; color: #92400e;">Current Interest</span></td>
                    <td>-</td>
                    <td>${Math.round((new Date() - new Date(previousDate)) / (1000 * 60 * 60 * 24))}</td>
                    <td class="amount-cell interest-amount">${formatCurrency(interestToToday)}</td>
                    <td class="amount-cell balance-amount" style="font-size: 1.1rem;">${formatCurrency(balance + interestToToday)}</td>
                    <td>Interest accrued to today</td>
                    <td>-</td>
                `;
                tbody.appendChild(row);
            }
        }
        
        // Export to Excel
        function exportToExcel() {
            // Prepare CSV content
            let csv = 'Date,Type,Amount,Days Since Last Entry,Interest Accrued,Running Balance,Notes\n';
            
            let balance = 0;
            let previousDate = null;
            
            transactions.forEach(transaction => {
                let daysSinceLastEntry = 0;
                let interestAccrued = 0;
                
                if (previousDate) {
                    daysSinceLastEntry = Math.max(0, (new Date(transaction.date) - new Date(previousDate)) / (1000 * 60 * 60 * 24));
                    if (balance > 0) {
                        interestAccrued = calculateInterest(balance, previousDate, transaction.date);
                    }
                }
                
                balance += interestAccrued;
                
                if (transaction.type === 'Loan Out') {
                    balance += transaction.amount;
                } else {
                    balance -= transaction.amount;
                }
                
                csv += `${transaction.date},"${transaction.type}",${transaction.amount},${Math.round(daysSinceLastEntry)},${interestAccrued.toFixed(2)},${balance.toFixed(2)},"${transaction.notes || ''}"\n`;
                
                previousDate = transaction.date;
            });
            
            // Add current interest row
            if (balance > 0 && previousDate) {
                const today = new Date().toISOString().split('T')[0];
                const daysToToday = Math.round((new Date(today) - new Date(previousDate)) / (1000 * 60 * 60 * 24));
                const interestToToday = calculateInterest(balance, previousDate, today);
                csv += `${today},"Current Interest",,${daysToToday},${interestToToday.toFixed(2)},${(balance + interestToToday).toFixed(2)},"Interest accrued to today"\n`;
            }
            
            // Create download
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `loan_tracker_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
        
        // Print report
        function printReport() {
            window.print();
        }
        
        // Save data to localStorage
        function saveToLocalStorage() {
            localStorage.setItem('loanTrackerTransactions', JSON.stringify(transactions));
        }
        
        // Load data from localStorage
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('loanTrackerTransactions');
            if (saved) {
                transactions = JSON.parse(saved);
            }
        }
        
        // Save data (download JSON)
        function saveData() {
            const data = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                interestRate: INTEREST_RATE,
                transactions: transactions
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `loan_tracker_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }
        
        // Load data
        function loadData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const data = JSON.parse(event.target.result);
                            if (data.transactions) {
                                transactions = data.transactions;
                                updateDisplay();
                                saveToLocalStorage();
                                alert('Data loaded successfully!');
                            } else {
                                alert('Invalid file format');
                            }
                        } catch (error) {
                            alert('Error loading file: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            
            input.click();
        }
        
        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone!')) {
                transactions = [];
                updateDisplay();
                saveToLocalStorage();
            }
        }
        
        // Add keyboard shortcut for adding transaction
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                addTransaction();
            }
        });
        
        // Add print styles
        const printStyles = document.createElement('style');
        printStyles.textContent = `
            @media print {
                body {
                    background: white;
                }
                .app-container {
                    box-shadow: none;
                }
                .controls-section,
                .input-section,
                .action-buttons,
                .btn {
                    display: none !important;
                }
                .table-container {
                    page-break-inside: avoid;
                }
            }
        `;
        document.head.appendChild(printStyles);
    </script>
</body>
</html>
